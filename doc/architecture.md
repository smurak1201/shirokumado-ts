# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ç™½ç†Šå ‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¨è¨­è¨ˆæ€æƒ³ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

- [ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦](#ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦)
- [ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®è¨­è¨ˆæ€æƒ³](#ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®è¨­è¨ˆæ€æƒ³)
- [ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ](#ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ)
- [çŠ¶æ…‹ç®¡ç†](#çŠ¶æ…‹ç®¡ç†)
- [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
- [è¨­å®šç®¡ç†](#è¨­å®šç®¡ç†)

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**Next.js App Router**ã‚’ãƒ™ãƒ¼ã‚¹ã¨ã—ãŸ**ãƒ¢ãƒãƒ¬ãƒæ§‹é€ **ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### ä¸»è¦ãªè¨­è¨ˆåŸå‰‡

1. **å‹å®‰å…¨æ€§**: TypeScript ã‚’å¾¹åº•çš„ã«æ´»ç”¨ã—ã€å‹å®šç¾©ã‚’ä¸€å…ƒç®¡ç†
2. **é–¢å¿ƒã®åˆ†é›¢**: æ©Ÿèƒ½ã”ã¨ã«ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’åˆ†å‰²
3. **å†åˆ©ç”¨æ€§**: ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ã‚’ç©æ¥µçš„ã«æ´»ç”¨
4. **ä¿å®ˆæ€§**: å°ã•ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨æ˜ç¢ºãªè²¬å‹™åˆ†æ‹…

## ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã®è¨­è¨ˆæ€æƒ³

### æ©Ÿèƒ½åˆ¥ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª (`app/dashboard/`)

ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ§‹é€ åŒ–ã•ã‚Œã¦ã„ã¾ã™ï¼š

```
app/dashboard/
â”œâ”€â”€ types.ts           # å…±é€šå‹å®šç¾©
â”œâ”€â”€ components/        # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ hooks/            # çŠ¶æ…‹ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯
â””â”€â”€ utils/            # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
```

**è¨­è¨ˆæ€æƒ³**:

- **`types.ts`**: ãã®æ©Ÿèƒ½ã§ä½¿ç”¨ã™ã‚‹å‹ã‚’ä¸€å…ƒç®¡ç†
- **`components/`**: UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã¿ã‚’é…ç½®
- **`hooks/`**: çŠ¶æ…‹ç®¡ç†ã‚„å‰¯ä½œç”¨ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã«åˆ†é›¢
- **`utils/`**: ç´”ç²‹é–¢æ•°ã¨ã—ã¦å®Ÿè£…å¯èƒ½ãªãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯

### ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ (`lib/`)

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä½¿ç”¨ã™ã‚‹ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’é…ç½®ï¼š

```
lib/
â”œâ”€â”€ config.ts         # è¨­å®šã®ä¸€å…ƒç®¡ç†
â”œâ”€â”€ prisma.ts         # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
â”œâ”€â”€ blob.ts           # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æ“ä½œ
â”œâ”€â”€ errors.ts         # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â””â”€â”€ api-helpers.ts    # APIå…±é€šå‡¦ç†
```

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®éšå±¤æ§‹é€ 

```
DashboardPage (Server Component)
  â””â”€â”€ DashboardContent (Client Component)
      â”œâ”€â”€ DashboardFormWrapper
      â”‚   â””â”€â”€ DashboardForm
      â””â”€â”€ ProductList
          â”œâ”€â”€ CategoryTabs
          â””â”€â”€ SortableProductItem
```

### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²ã®åŸå‰‡

1. **å˜ä¸€è²¬ä»»ã®åŸå‰‡**: å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ 1 ã¤ã®è²¬å‹™ã‚’æŒã¤
2. **å†åˆ©ç”¨æ€§**: æ±ç”¨çš„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯åˆ†é›¢ï¼ˆä¾‹: `CategoryTabs`, `SortableProductItem`ï¼‰
3. **é–¢å¿ƒã®åˆ†é›¢**: UI ã¨ãƒ­ã‚¸ãƒƒã‚¯ã‚’åˆ†é›¢ï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã‚’ä½¿ç”¨ï¼‰

### ä¾‹: ProductList ã®åˆ†å‰²

**Before** (840 è¡Œã®å·¨å¤§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ):

- ã‚¿ãƒ–çŠ¶æ…‹ç®¡ç†
- å•†å“é †åºå¤‰æ›´ãƒ­ã‚¸ãƒƒã‚¯
- ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ– UI
- ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ— UI
- ã™ã¹ã¦ãŒ 1 ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«

**After** (åˆ†å‰²å¾Œ):

- `ProductList.tsx`: ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆç´„ 490 è¡Œï¼‰
- `CategoryTabs.tsx`: ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ– UI
- `SortableProductItem.tsx`: ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å¯èƒ½ãªå•†å“ã‚¢ã‚¤ãƒ†ãƒ 
- `useTabState.ts`: ã‚¿ãƒ–çŠ¶æ…‹ç®¡ç†ãƒ•ãƒƒã‚¯
- `useProductReorder.ts`: å•†å“é †åºå¤‰æ›´ãƒ•ãƒƒã‚¯
- `productUtils.ts`: å•†å“ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°é–¢æ•°

## çŠ¶æ…‹ç®¡ç†

### çŠ¶æ…‹ç®¡ç†ã®æˆ¦ç•¥

1. **Server State**: Server Components ã§ç›´æ¥ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
2. **Client State**: React ã®`useState`ã¨ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯
3. **Persistent State**: `localStorage`ã‚’ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã§ç®¡ç†

### ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®æ´»ç”¨

#### `useTabState`

```typescript
// ã‚¿ãƒ–çŠ¶æ…‹ã‚’localStorageã¨åŒæœŸ
const { activeTab, setActiveTab } = useTabState();
```

#### `useCategoryTabState`

```typescript
// ã‚«ãƒ†ã‚´ãƒªãƒ¼ã‚¿ãƒ–ã®çŠ¶æ…‹ç®¡ç†
const { activeCategoryTab, setActiveCategoryTab } = useCategoryTabState(
  products,
  categories
);
```

#### `useProductReorder`

```typescript
// å•†å“é †åºå¤‰æ›´ã®æ¥½è¦³çš„UIæ›´æ–°
const { reorderProducts } = useProductReorder(setProducts, refreshProducts);
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### Server Component â†’ Client Component

```
DashboardPage (Server Component)
  â†“ ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒ
  â†“ propsã§æ¸¡ã™
DashboardContent (Client Component)
  â†“ çŠ¶æ…‹ç®¡ç†
  â†“ ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
```

### API å‘¼ã³å‡ºã—ã®æµã‚Œ

```
Client Component
  â†“ fetch('/api/products')
API Route
  â†“ Prismaã‚¯ã‚¨ãƒª
Database
  â†“ ãƒ¬ã‚¹ãƒãƒ³ã‚¹
Client Component (çŠ¶æ…‹æ›´æ–°)
```

### æ¥½è¦³çš„ UI æ›´æ–°

å•†å“é †åºå¤‰æ›´æ™‚ã®ãƒ•ãƒ­ãƒ¼ï¼š

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—
2. ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ã‚’å³åº§ã«æ›´æ–°ï¼ˆæ¥½è¦³çš„æ›´æ–°ï¼‰
3. APIå‘¼ã³å‡ºã—ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰
4. æˆåŠŸ: ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
5. å¤±æ•—: ã‚¨ãƒ©ãƒ¼è¡¨ç¤º + å…ƒã®çŠ¶æ…‹ã«æˆ»ã™
```

## è¨­å®šç®¡ç†

### ä¸€å…ƒç®¡ç† (`lib/config.ts`)

ã™ã¹ã¦ã®è¨­å®šå€¤ã‚’`lib/config.ts`ã«é›†ç´„ï¼š

```typescript
export const config = {
  imageConfig: {
    MAX_FILE_SIZE_MB: 4,
    COMPRESSION_TARGET_SIZE_MB: 3.5,
    // ...
  },
  blobConfig: {
    PRODUCT_IMAGE_FOLDER: "products",
    CACHE_CONTROL_MAX_AGE: 31536000,
  },
  apiConfig: {
    PRODUCT_LIST_CACHE_SECONDS: 60,
    // ...
  },
  displayConfig: {
    GRID_COLUMNS: 3,
  },
};
```

**åˆ©ç‚¹**:

- è¨­å®šå€¤ã®å¤‰æ›´ãŒå®¹æ˜“
- ç’°å¢ƒã”ã¨ã®è¨­å®šãŒå¯èƒ½
- å‹å®‰å…¨æ€§ã®ç¢ºä¿

## å‹å®šç¾©ã®ç®¡ç†

### å…±é€šå‹å®šç¾© (`app/dashboard/types.ts`)

æ©Ÿèƒ½å†…ã§ä½¿ç”¨ã™ã‚‹å‹ã‚’ä¸€å…ƒç®¡ç†ï¼š

```typescript
export interface Category {
  id: number;
  name: string;
}

export interface Product {
  id: number;
  name: string;
  // ...
}
```

**åˆ©ç‚¹**:

- å‹å®šç¾©ã®é‡è¤‡ã‚’é˜²æ­¢
- ä¸€è²«æ€§ã®ç¢ºä¿
- å¤‰æ›´æ™‚ã®å½±éŸ¿ç¯„å›²ãŒæ˜ç¢º

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### çµ±ä¸€ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã‚¯ãƒ©ã‚¹ (`lib/errors.ts`)

```typescript
// ä½¿ç”¨ä¾‹
throw new ValidationError("Invalid input");
throw new NotFoundError("Product");
throw new DatabaseError("Failed to connect");
```

### API Routes ã§ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```typescript
import { withErrorHandling, apiSuccess } from "@/lib/api-helpers";

export const GET = withErrorHandling(async () => {
  const data = await fetchData();
  return apiSuccess({ data });
});
```

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### ç”»åƒæœ€é©åŒ–

- **ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰åœ§ç¸®**: `lib/image-compression.ts`
- **WebP å½¢å¼**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ WebP å½¢å¼ã«å¤‰æ›
- **ã‚µã‚¤ã‚ºåˆ¶é™**: 4MB ä»¥ä¸‹ã«åˆ¶é™

### ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ³ã‚°

- **Server Components**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ Server Components ã‚’ä½¿ç”¨
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: API Routes ã§é©åˆ‡ãªã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®š
- **å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿**: Prisma ã®`select`ã§å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿å–å¾—

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

### å…¥åŠ›æ¤œè¨¼

- **API Routes**: ã™ã¹ã¦ã®å…¥åŠ›ã‚’æ¤œè¨¼
- **ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ãƒ•ã‚¡ã‚¤ãƒ«ã‚¿ã‚¤ãƒ—ã¨ã‚µã‚¤ã‚ºã‚’æ¤œè¨¼
- **Prisma**: SQL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³å¯¾ç­–ãŒè‡ªå‹•çš„ã«é©ç”¨

### ç’°å¢ƒå¤‰æ•°

- **æ©Ÿå¯†æƒ…å ±**: ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
- **å‹å®‰å…¨æ€§**: `lib/env.ts`ã§å‹å®šç¾©

## å‚è€ƒãƒªãƒ³ã‚¯

- [Next.js App Router](https://nextjs.org/docs/app)
- [React Server Components](https://react.dev/blog/2023/03/22/react-labs-what-we-have-been-working-on-march-2023#react-server-components)
- [Prisma Best Practices](https://www.prisma.io/docs/guides/performance-and-optimization)
- [TypeScript Handbook](https://www.typescriptlang.org/docs/handbook/intro.html)

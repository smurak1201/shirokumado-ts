# Claude Code 設定

## 言語設定

- すべての出力は日本語で行うこと
- コミットメッセージ、コードコメント、説明文はすべて日本語で記述すること

## 基本的なルール

- **import文**: 未使用のインポートは削除すること
- **ダミーのコード**: 動作しない仮置きの関数や変数は含めないこと
- **修正範囲**: 依頼された部分以外は原則として変更しないが、関連するのなら提案すること

## コメント規則

**基本方針: コードだけで意図が明確に伝わる場合、コメントは不要**

コメントを記述するのは以下の場合のみ:

### コメントが必要な場合

1. **初心者にはわかりにくい実装**
   - CSSの特殊な挙動（`position:fixed`の副作用など）
   - ライブラリ特有の使い方
   - 複雑なアルゴリズムや処理フロー

   ```typescript
   // position:fixed のヘッダーに対応するスペーサー
   // fixedは通常フローから外れるため、このスペーサーがないと
   // 下のコンテンツがヘッダーの裏に隠れてしまう
   <div style={{ height: "var(--header-height)" }} />
   ```

2. **このアプリ特有の設計判断**
   - なぜその実装を選んだのか
   - ビジネスロジック上の判断理由
   - トレードオフの説明

   ```typescript
   // 設計判断: データ取得エラー時もページは表示する（部分的なダウンタイムを許容）
   // ユーザーには通知せず、運用者のみログで確認
   ```

### コメントが不要な場合

- コンポーネント名や関数名から役割が明確な場合
- 自明なコード（`<Header />`、`<Footer />`など）
- 標準的なReact/Next.jsのパターン
- Tailwind CSSの基本的な使い方

### フォーマット

- すべてのコメントは**日本語**で記述すること
- **簡潔に**記述すること（長い説明が必要ならコードを改善）
- ファイルの先頭には簡潔な説明のみ（冗長な箇条書きは不要）

## 設計原則

- **単一責任**: 機能単位でコードを分割すること
- **YAGNI**: 現時点で必要な機能のみ実装すること
- **KISS**: 最もシンプルな解決策を選ぶこと
- **DRY**: 3箇所目で共通化を検討。似ているだけのロジックは無理に共通化しない
- **モバイルファースト**: スマートフォン向けのデザインを基本とし、大きな画面へ拡張すること

## 型とコード品質

- 関数の引数と返り値には型を付けること
- リントエラーを解消すること
- ハードコードとマジックナンバーを避け、定数として一元管理すること

## React / Next.js

> 参考: [Vercel React Best Practices](https://vercel.com/blog/introducing-react-best-practices)

### パフォーマンス

- **独立した非同期操作は`Promise.all()`で並列実行すること**
- **重いコンポーネントは`next/dynamic`で動的インポートすること**
- **派生状態はレンダリング中に計算すること**（useState + useEffectで同期しない）
- **単純な式を`useMemo`でラップしないこと**

### Server Components

- **デフォルトで Server Components を使用すること**
- **Server Actionsでも認証を検証すること**
- **RSC境界ではクライアントが必要なフィールドのみ渡すこと**

### コンポーネント設計

- **単一責任**: 各コンポーネントは1つの責務を持つこと
- **状態のリフトアップ**: 共有状態は親コンポーネントで管理
- **カスタムフック**: `use`プレフィックス（例: `useAuth`）
- **イベントハンドラー**: `handle`プレフィックス（例: `handleSubmit`）

### エラーハンドリング

- **非同期処理には必ずtry-catchを実装すること**
- **エラーメッセージはユーザーにとって分かりやすく**
- **API Routesではエラーハンドリングを統一すること**

### セキュリティ

- **ユーザー入力はサニタイズすること**
- **`dangerouslySetInnerHTML`は原則使用禁止**
- **環境変数の`NEXT_PUBLIC_`プレフィックスの有無を意識すること**

## Tailwind CSS

- **ユーティリティクラスを直接使用すること**
- **動的クラス名（`bg-${color}-500`）を避けること**
- **モバイルファースト**: `sm:`, `md:`, `lg:` で拡張

## アクセシビリティ

- **セマンティックHTML**: 適切なタグ（`<header>`, `<main>`, `<nav>`等）を使用すること
- **aria属性**: アイコンボタンには`aria-label`を設定すること

## 画像

- **`next/image`を使用すること**: 自動最適化、遅延読み込み、レスポンシブ対応

## 品質チェックリスト

### コード品質

- [ ] この機能は**今**必要か？（YAGNI）
- [ ] もっとシンプルな方法はないか？（KISS）
- [ ] 独立した非同期処理は並列化しているか？
- [ ] エラーハンドリングは実装されているか？

### コメント品質

- [ ] 不要なコメントは削除されているか？（自明なコードにコメントは不要）
- [ ] 初心者にわかりにくい箇所に簡潔な説明があるか？
- [ ] アプリ特有の設計判断に理由が記述されているか？
- [ ] コメントは簡潔で、日本語で記述されているか？

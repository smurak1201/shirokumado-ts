# Claude Code 設定

## 言語設定

- すべての出力は日本語で行うこと
- コミットメッセージ、コードコメント、説明文はすべて日本語で記述すること

## 基本的なルール

- **import文**: 未使用のインポートは削除すること
- **ダミーのコード**: 動作しない仮置きの関数や変数は含めないこと
- **修正範囲**: 依頼された部分以外は原則として変更しないが、関連するのなら提案すること

## コメント規則（学習用途対応）

このプロジェクトは学習用途も想定しているため、コードを読む人が理解しやすいコメントを記述します。

### 基本方針

- すべてのコメントは**日本語**で記述すること
- **What（何をするか）**だけでなく、**Why（なぜそうするか）**を重視すること
- コードを読む人が「なるほど」と理解できる説明を心がけること

### 必須コメント

- **モジュール/ファイル**: ファイルの先頭でファイル全体の目的、用途、主な機能をJSDocで記述
  - 使用する環境変数があれば明記
  - ベストプラクティスや注意点を箇条書きで記載
- **型定義**: 型の目的と、なぜその形にしたのかを説明
- **関数**: 機能説明、`@param`（説明と具体例）、`@returns`、`@throws`を含むJSDocを記述
- **重要な変数・定数**: 設定値やメタデータには目的と使用用途を説明
- **複雑なロジック**: 処理の意図、判定条件、優先順位などを詳細に説明

### 学習者向け推奨コメント

- **実装の理由**: なぜその実装を選んだのか（代替案があればそれも記載）
  ```typescript
  // Promise.allで並列実行することでパフォーマンスを向上
  // 各処理は独立しているため、順次実行する必要がない
  const [data1, data2] = await Promise.all([fetch1(), fetch2()]);
  ```

- **注意点・落とし穴**: ハマりやすいポイントや制約事項
  ```typescript
  // 注意: position:fixedは通常フローから外れるため、
  // 後続要素が重ならないようスペーサーが必要
  <div style={{ height: "var(--header-height)" }} />
  ```

- **参考リンク**: 公式ドキュメントや参考記事（学習の助けになる場合）
  ```typescript
  /**
   * Server Component として実装
   * @see https://nextjs.org/docs/app/building-your-application/rendering/server-components
   */
  ```

- **トレードオフ**: 選択した手法の利点と欠点
  ```typescript
  // クライアント側でフィルタリング（サーバー負荷軽減、リアルタイム性向上）
  // トレードオフ: 初期データ量が多いと初回表示が遅くなる可能性
  ```

- **TODO/FIXME**: 改善点や未実装の機能
  ```typescript
  // TODO: ページネーション実装（データ量増加時に対応）
  // FIXME: エラー時のリトライ処理を追加
  ```

### フォーマット

- **箇条書き**: 機能や条件が複数ある場合は箇条書きで整理
- **実装の特性**: Server Component、Client Component、動的/静的レンダリングなどを明記
- **型情報**: TypeScriptの型がなぜその形なのかを説明（複雑な型の場合）

## 設計原則

- **単一責任**: 機能単位でコードを分割すること
- **YAGNI**: 現時点で必要な機能のみ実装すること
- **KISS**: 最もシンプルな解決策を選ぶこと
- **DRY**: 3箇所目で共通化を検討。似ているだけのロジックは無理に共通化しない
- **モバイルファースト**: スマートフォン向けのデザインを基本とし、大きな画面へ拡張すること

## 型とコード品質

- 関数の引数と返り値には型を付けること
- リントエラーを解消すること
- ハードコードとマジックナンバーを避け、定数として一元管理すること

## React / Next.js

> 参考: [Vercel React Best Practices](https://vercel.com/blog/introducing-react-best-practices)

### パフォーマンス

- **独立した非同期操作は`Promise.all()`で並列実行すること**
- **重いコンポーネントは`next/dynamic`で動的インポートすること**
- **派生状態はレンダリング中に計算すること**（useState + useEffectで同期しない）
- **単純な式を`useMemo`でラップしないこと**

### Server Components

- **デフォルトで Server Components を使用すること**
- **Server Actionsでも認証を検証すること**
- **RSC境界ではクライアントが必要なフィールドのみ渡すこと**

### コンポーネント設計

- **単一責任**: 各コンポーネントは1つの責務を持つこと
- **状態のリフトアップ**: 共有状態は親コンポーネントで管理
- **カスタムフック**: `use`プレフィックス（例: `useAuth`）
- **イベントハンドラー**: `handle`プレフィックス（例: `handleSubmit`）

### コンポーネントのコメント

- **コンポーネントファイル**: ファイルの先頭で以下を記述
  - コンポーネントの目的と用途
  - 主な機能（箇条書き）
  - 使用する環境変数やprops（型と説明）
  - 実装の特性（Server/Client Component、動的/静的など）
  - ベストプラクティスや注意点

- **コンポーネント関数**: 各コンポーネントに以下を記述
  - 目的と機能の説明
  - `@param` でpropsの詳細（型、デフォルト値、具体例）
  - 構成要素や主要な子コンポーネント

- **JSXインラインコメント**: UI要素ごとに以下を記述
  - 各要素の役割や目的
  - レイアウト上の配置理由
  - CSS変数やスタイルの意図
  - 他の要素との関係性（position:fixedとスペーサーなど）

- **状態管理**: useState、useEffectなどのフックには目的を説明
  ```tsx
  // ユーザーのスクロール位置を追跡（ヘッダーの表示/非表示制御用）
  const [scrollY, setScrollY] = useState(0);
  ```

- **イベントハンドラー**: 処理内容と副作用を説明
  ```tsx
  // フォーム送信時: バリデーション → API送信 → 成功時リダイレクト
  const handleSubmit = async (e: FormEvent) => { ... }
  ```

### エラーハンドリング

- **非同期処理には必ずtry-catchを実装すること**
- **エラーメッセージはユーザーにとって分かりやすく**
- **API Routesではエラーハンドリングを統一すること**

### セキュリティ

- **ユーザー入力はサニタイズすること**
- **`dangerouslySetInnerHTML`は原則使用禁止**
- **環境変数の`NEXT_PUBLIC_`プレフィックスの有無を意識すること**

## Tailwind CSS

- **ユーティリティクラスを直接使用すること**
- **動的クラス名（`bg-${color}-500`）を避けること**
- **モバイルファースト**: `sm:`, `md:`, `lg:` で拡張

## アクセシビリティ

- **セマンティックHTML**: 適切なタグ（`<header>`, `<main>`, `<nav>`等）を使用すること
- **aria属性**: アイコンボタンには`aria-label`を設定すること

## 画像

- **`next/image`を使用すること**: 自動最適化、遅延読み込み、レスポンシブ対応

## 品質チェックリスト

### コード品質

- [ ] この機能は**今**必要か？（YAGNI）
- [ ] もっとシンプルな方法はないか？（KISS）
- [ ] 独立した非同期処理は並列化しているか？
- [ ] エラーハンドリングは実装されているか？

### コメント品質（学習用途）

- [ ] ファイルの先頭に目的と用途が記述されているか？
- [ ] すべての関数に**Why（なぜ）**を含むJSDocがあるか？
- [ ] 複雑なロジックに実装の理由が説明されているか？
- [ ] 注意点や落とし穴が明記されているか？
- [ ] 実装の特性（Server/Client Component等）が明記されているか？
- [ ] 学習者が理解しやすい日本語で記述されているか？

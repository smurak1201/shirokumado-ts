# 仕様書の書き方ガイド

このドキュメントは、`updates/` ディレクトリ内の仕様書を作成する際のガイドです。

**目的**: Claudeが仕様書を読み込んで実装作業を行えるようにする

---

## Claudeへの指示

仕様書の作成を依頼する際:

```
updates/README.md を読んで、○○機能の仕様書を作成してください
```

作成済みの仕様書に沿って実装を依頼する際:

```
updates/YYYY-MM-DD-NN-タスク名.md を読んで、タスク1から順番に実装してください
```

---

## ファイル命名規則

```
YYYY-MM-DD-NN-タスク名.md
```

- `YYYY-MM-DD`: 作成日
- `NN`: 連番（01, 02, 03...）
- `タスク名`: ケバブケース（例: frontend-redesign, faq-page）

---

## 仕様書のポイント

1. **曖昧さを排除する** - 「適切に」「必要に応じて」を避け、具体的な値・ファイルパス・クラス名を明記
2. **選択肢を提示しない** - 「AまたはB」「〜する場合」のように複数の実装方法を提示しない。仕様書の時点で方針を1つに決定し、その実装方法のみを記載する。方針を決められない場合は仕様書の作成を中断し、ユーザーに確認する
3. **コード例で実装の全体像を示す** - import文や型定義を含め、どういう実装をするかが伝わるコード例を記載する。既存ファイルに関数を追加する場合、新たに必要になるインポート文の追加も明記する
4. **変更箇所を明確に** - 「変更前」「変更後」を並べる。新規作成は「**新規作成**」と明記。行番号はタスクの進行でずれる可能性があるため、変更前コードの内容自体で特定できるようにする
5. **変更後コードは省略しない** - `<details>`で折りたたむのは良いが、`{/* 以降は変更なし */}`のような省略はしない。Claude Codeが差分を正確に判断できるよう、変更後の全体コードを記載する
6. **タスクの依存関係を明示** - 実行順序通りに並べる。並列実行可能なタスクがあれば備考に記載する（例: 「タスク5-6は並列実行可能」）
7. **前提条件の確認・セットアップをタスクに含める** - 実装に必要な環境変数、npmパッケージ、DBマイグレーション、CSS変数などを調査し、未充足のものがあれば最初のタスクとしてセットアップを含める。不明な場合は仕様書の作成を中断し、ユーザーに確認する
8. **完了条件を具体的に** - 何をもって完了とするかを明記
9. **既存コードの参照を活用** - 「`app/components/ProductGrid.tsx` を参考に実装」のように記載するとスタイルを合わせやすい
10. **「変更しないもの」を明記** - 関連しそうだが変更すべきでないファイルや設定がある場合、備考に記載する。Claudeが修正範囲を広げすぎることを防ぐ

---

## 基本構造

仕様書は以下のセクションで構成する:

1. **ヘッダー情報**（必須）
2. **目次**（必須）
3. **進捗状況テーブル**（必須） - 進捗管理はここに集約
4. **改修の目的**（必須）
5. **タスク詳細**（必須）
6. **変更対象ファイル一覧**（必須）
7. **備考**（任意）

---

## セクション詳細

### 1. ヘッダー情報

```markdown
# タイトル

**日付**: YYYY-MM-DD
**ブランチ**: feature/ブランチ名
**対象**: 対象ページやコンポーネント名（ファイルパス）
**ステータス**: 未着手 | 進行中 | 完了
**完了日**: - | YYYY-MM-DD
```

### 2. 目次

各セクション・タスクへのアンカーリンクを設置する。タスク数が多い場合は特に重要。

```markdown
## 目次

- [進捗状況](#進捗状況)
- [改修の目的](#改修の目的)
- [タスク詳細](#タスク詳細)
  - [タスク1: タスク名](#タスク1-タスク名)
  - [タスク2: タスク名](#タスク2-タスク名)
- [変更対象ファイル一覧](#変更対象ファイル一覧)
```

### 3. 進捗状況テーブル

進捗管理はこのテーブルに集約する。タスク詳細やファイル一覧では進捗を管理しない。

```markdown
## 進捗状況

| #   | タスク                 | 対応課題 | 優先度 | ステータス | 備考 |
| --- | ---------------------- | :------: | :----: | :--------: | ---- |
| 1   | タスク名1              |    1     |   高   |    [ ]     |      |
| 2   | タスク名2              |   1,2    |   中   |    [ ]     |      |
| 3   | 動作確認・ビルドテスト |    -     |   -    |    [ ]     |      |

**凡例**: `[ ]` 未着手 / `[~]` 作業中 / `[o]` 完了
```

**優先度**: `高` / `中` / `低` / `-`（なし）

### 4. 改修の目的

```markdown
## 改修の目的

### 背景

なぜこの改修が必要なのかを説明する。

### 課題

- **課題1**: 説明
- **課題2**: 説明

### 設計方針

- **方針1**: 説明
- **方針2**: 説明
```

### 5. タスク詳細

Claudeが実装しやすい形式で書く。コード例が長い場合は `<details>` タグで折りたたむ。最終タスクは必ず「動作確認・ビルドテスト」にする。

````markdown
### タスク1: タスク名

**対象ファイル**:

- `app/example/page.tsx`（既存・変更）
- `app/components/Example.tsx`（**新規作成**）

**問題点**:

現状の問題を1-2文で説明する。

**修正内容**:

何をどう変更するかを具体的に説明する。

<details>
<summary>実装例（クリックで展開）</summary>

```tsx
// app/components/Example.tsx（新規作成）
"use client";

import { useState } from "react";

interface ExampleProps {
  title: string;
}

export default function Example({ title }: ExampleProps) {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <div>
      <h1>{title}</h1>
      <button onClick={() => setIsOpen(!isOpen)}>
        {isOpen ? "閉じる" : "開く"}
      </button>
    </div>
  );
}
```

</details>

**page.tsx の変更（10行目付近）**:

```tsx
// 変更前
import { OldComponent } from "./OldComponent";

// 変更後
import Example from "../components/Example";
```
````

**タスク詳細のポイント**:

- 長いコード例は `<details>` で折りたたみ、短い変更前/変更後はそのまま表示。ただし折りたたんでも省略はしない（変更後の全体コードを記載する）
- `<summary>` と内容の間、`</details>` の前に**空行が必須**（Markdownのレンダリングに必要）
- 新規作成ファイルは**太字**で明示
- 変更による効果や影響を受けない箇所も必要に応じて記載する

#### 動作確認・ビルドテスト（最終タスク）

最終タスクは必ず動作確認とビルドテストにする。具体的な確認シナリオを記載する。

```markdown
### タスクN: 動作確認・ビルドテスト

**自動確認**（Claudeが実行）:

1. **ビルド確認** (`npm run build`)
   - ビルドエラーがないこと
   - TypeScriptエラーがないこと

2. **リント確認** (`npm run lint`)
   - リントエラーがないこと
   - 未使用のインポートがないこと

**手動確認**（ユーザーが実行）:

1. **ローカル確認** (`npm run dev`)
   - 機能が正常に動作する具体的なシナリオを列挙
```

Claudeの完了条件は「自動確認」のみ。「手動確認」はユーザーに委ねる。

### 6. 変更対象ファイル一覧

```markdown
## 変更対象ファイル一覧

| ファイル                     | 変更内容               |
| ---------------------------- | ---------------------- |
| `app/example/page.tsx`       | importの変更           |
| `app/components/Example.tsx` | **新規作成**           |
| `lib/config.ts`              | 定数追加（末尾に追記） |
```

### 7. 備考（任意）

注意事項、参考となる類似実装、タスク固有の技術的な注意点を記載する。内容に応じてサブセクションに分ける。

```markdown
## 備考

### 注意事項

- 既存の○○機能には影響を与えないこと
- `config.ts`の既存の定数は変更しないこと

### 参考

- 類似実装: `app/components/ProductGrid.tsx`
- 公式ドキュメント: Next.js App Router ○○
```

---

## タスクの粒度とスケール

### タスクの粒度

1つのタスクは「1つの目的、1-3ファイルの変更」を目安とする。以下のアンチパターンを避ける:

- **タスク間の重複**: 前のタスクの結果を含む形で次のタスクが書かれている
- **コード例のないタスク**: 「詳細な調整が必要」のみで具体的な変更内容がない
- **実質変更不要なタスク**: 「確認して必要に応じて修正」のような不確定なタスク

### 仕様書のスケール上限

1つの仕様書で扱う変更対象ファイル数は**20ファイル以下**を目安とする。それを超える場合はディレクトリ単位やレイヤー単位で仕様書を分割する。

---

## 実装後の更新

タスク完了時に進捗状況テーブルを更新する:

- `[ ]` → `[~]`: 作業開始時
- `[~]` → `[o]`: 作業完了時

全タスク完了後、ヘッダーのステータスを「完了」に変更し、完了日を追記する。
